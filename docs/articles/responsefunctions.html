<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Response functions • waterlevel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Response functions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">waterlevel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/responsefunctions.html">Response functions</a>
    </li>
    <li>
      <a href="../articles/staticbe.html">Static Barometric/Loading Efficiency Calculations</a>
    </li>
    <li>
      <a href="../articles/synthetic_example.html">Synthetic example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Response functions</h1>
            
            <h4 class="date">2019-05-13</h4>
      
      
      <div class="hidden name"><code>responsefunctions.Rmd</code></div>

    </div>

    
    
<p><img src="responsefunctions_files/figure-html/plotwl-1.png" width="700"><img src="responsefunctions_files/figure-html/plotwl-2.png" width="700"><img src="responsefunctions_files/figure-html/plotwl-3.png" width="700"></p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Response functions can provide a more complete picture than single value methods that were presented in the <a href="staticbe.html">Static BE vignette</a>. Static BE methods tend to be very simple to apply but their interpretation and any derivative values determined from them should be treated as rough estimates in all but the most ideal circumstances. In the <a href="synthetic_example.html">Synthetic example vignette</a> we fit barometric response functions for a synthetic dataset with a known response function to test the efficiency of different methods.</p>
<p>This vignette shows how to calculate the impulse response functions (time domain) and frequency response functions (frequency domain) for water levels, barometric pressure and Earth tides using field data. Including terms for Earth tides is suggested for confined and semi-confined aquifers so our examples will show how to easily include them with the <em>earthtide</em> package.</p>
<hr>
<div id="time-domain-barometric-response-function" class="section level2">
<h2 class="hasAnchor">
<a href="#time-domain-barometric-response-function" class="anchor"></a>Time domain barometric response function</h2>
<p>We have decided to take the approach used in the <em>recipes</em> package for the time being where we provide steps to build our dataset to be used for linear regression. By building the dataset with a <em>recipe</em>, it also allows for the user to easily specify the model of choice. For our examples we will use the <em>lm</em> function to determine the appropriate parameters. By the end of the time-domain section we will have fit the data using the following methods:</p>
<ul>
<li>Lagged barometric response
<ul>
<li>Regular spaced <span class="citation">(Rasmussen and Crawford 1997)</span>
</li>
<li>Irregular spacing</li>
<li>Distributed lag</li>
</ul>
</li>
<li>Earth tides
<ul>
<li>Harmonic (specified frequencies) <span class="citation">(Rasmussen and Mote 2007)</span>
</li>
<li>Theoretical
<ul>
<li>Lagged <span class="citation">(Toll and Rasmussen 2007)</span>
</li>
<li>Harmonic constituents <span class="citation">(Wenzel 1996)</span>
</li>
</ul>
</li>
</ul>
</li>
<li>Background trend (spline fit)</li>
<li>Level shifts</li>
</ul>
<hr>
<div id="regular-and-irregular-spaced-lag-method" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-and-irregular-spaced-lag-method" class="anchor"></a>Regular and irregular spaced lag method</h3>
<p>Regular and irregular lag models can be specified in the same manner. In this example we generate a set of regularly spaced lags using seq, but they could be specified individually or with another function. We find logarithmically spaced lags generated with <em>log_lags</em> can work well to get good resolution at early times while still having a parsimoneous model.</p>
<p>Monitoring interval: 2 minutes</p>
<p>Barometric lag range: 0 to 360 by 5</p>
<p>Earth tide lag range: 0 to 180 by 15</p>
<p>Natural spline fit for temporal trend with 31 degrees of freedom</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
delta_t &lt;-<span class="st"> </span><span class="dv">120</span>                          <span class="co"># seconds</span>

max_lag_baro &lt;-<span class="st"> </span><span class="dv">43200</span><span class="op">/</span>delta_t           <span class="co"># 0.5 days </span>
lag_baro_spacing &lt;-<span class="st"> </span><span class="dv">2</span>                   <span class="co"># 4 minute between lags</span>

max_lag_et &lt;-<span class="st"> </span><span class="dv">21600</span><span class="op">/</span>delta_t             <span class="co"># 0.25 days</span>
lag_et_spacing &lt;-<span class="st"> </span><span class="dv">15</span>                    <span class="co"># 30 minutes between lags</span>

ns_df &lt;-<span class="st"> </span><span class="dv">21</span>                             <span class="co"># natural spline with 21 terms</span>

ba_lags &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, max_lag_baro, lag_baro_spacing)   <span class="co"># barometric lag terms (reg)</span>
et_lags &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, max_lag_et, lag_et_spacing)       <span class="co"># earthtide lag terms  (reg)</span></code></pre></div>
</div>
<div id="example-recipe" class="section level3">
<h3 class="hasAnchor">
<a href="#example-recipe" class="anchor"></a>Example recipe:</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
dat &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., transducer) <span class="op">%&gt;%</span><span class="st">                                           </span><span class="co">#1</span>
<span class="st">  </span><span class="kw"><a href="../reference/step_lag_matrix.html">step_lag_matrix</a></span>(baro, <span class="dt">lag =</span> ba_lags, <span class="dt">role =</span> <span class="st">'lag_matrix_baro'</span>) <span class="op">%&gt;%</span><span class="st">          </span><span class="co">#2</span>
<span class="st">  </span><span class="kw"><a href="../reference/step_lag_matrix.html">step_lag_matrix</a></span>(et, <span class="dt">lag =</span> et_lags, <span class="dt">role =</span> <span class="st">'lag_matrix_et'</span>) <span class="op">%&gt;%</span><span class="st">              </span><span class="co">#3</span>
<span class="st">  </span><span class="kw">step_mutate</span>(<span class="dt">datetime2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(datetime)) <span class="op">%&gt;%</span><span class="st">                           </span><span class="co">#4</span>
<span class="st">  </span><span class="kw">step_ns</span>(datetime2, <span class="dt">deg_free =</span> ns_df, <span class="dt">role =</span> <span class="st">'splines'</span>) <span class="op">%&gt;%</span><span class="st">                  </span><span class="co">#5</span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                                  </span><span class="co">#6</span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()                                                                   <span class="co">#7</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Take the transducer dataset, use <em>wl</em> as my dependent variable</li>
<li>Lag the <em>baro</em> column to have a maximum lag of 0.5 day with 4 minute spacing</li>
<li>Lag the <em>et</em> column to have a maximum lag of 0.25 days with 30 minute spacing</li>
<li>Convert the datetime column from POSIXt to numeric (necessary for step_ns)</li>
<li>Generate spline basis function regressors</li>
<li>Run the steps</li>
<li>Generate output for lm</li>
</ol>
<hr>
</div>
<div id="fit-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-the-model" class="anchor"></a>Fit the model:</h3>
<p>We can fit the model with <em>lm</em> and the fitting method is the same for each of the recipes so we will not repeat that code in the following examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(outcome<span class="op">~</span>lag_matrix_baro<span class="op">+</span>lag_matrix_et <span class="op">+</span><span class="st"> </span>splines, dat,      <span class="co"># fit model </span>
          <span class="dt">x =</span> <span class="ot">FALSE</span>, <span class="dt">y =</span> <span class="ot">FALSE</span>, <span class="dt">tol =</span> <span class="fl">1e-50</span>, 
          <span class="dt">na.action =</span> na.exclude)

dat &lt;-<span class="st"> </span>transducer <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">residuals =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">residuals</a></span>(fit))         <span class="co"># add residuals</span>

resp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/response_from_fit.html">response_from_fit</a></span>(fit)                           <span class="co"># get the baro response</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/summarize_lm.html">summarize_lm</a></span>(fit)
<span class="co">#&gt;    n_obs n_coef    df        sigma r_squared adj_r_squared       AIC</span>
<span class="co">#&gt; 1: 36361    216 36145 0.0003069872 0.9999527     0.9999524 -484821.4</span>
<span class="co">#&gt;          BIC   logLik</span>
<span class="co">#&gt; 1: -482976.6 242627.7</span></code></pre></div>
<p><img src="responsefunctions_files/figure-html/solvesimpleplot-1.png" width="412.8"><img src="responsefunctions_files/figure-html/solvesimpleplot-2.png" width="412.8"></p>
<hr>
</div>
</div>
<div id="distributed-lag-method" class="section level2">
<h2 class="hasAnchor">
<a href="#distributed-lag-method" class="anchor"></a>Distributed lag method</h2>
<p>For this example we use <em>step_lag_distributed</em> instead of <em>step_lag_matrix</em>. We then specify knots that are logaritmically spaced using <em>log_lags</em>. This decreases the number of regressors while still capturing early time behaviour. Results are visibly similar, however, the distributed lag model is requires fewer regressors, is faster to solve, and provides better early time resolution in this example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
knots &lt;-<span class="st"> </span><span class="kw"><a href="../reference/log_lags.html">log_lags</a></span>(<span class="dv">15</span>, max_lag_baro)
dat &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., transducer) <span class="op">%&gt;%</span><span class="st">                          </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_distributed_lag.html">step_distributed_lag</a></span>(baro, <span class="dt">knots =</span> knots) <span class="op">%&gt;%</span><span class="st">    </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_lag_matrix.html">step_lag_matrix</a></span>(et, <span class="dt">lag =</span> et_lags) <span class="op">%&gt;%</span><span class="st">      </span>
<span class="st">  </span><span class="kw">step_mutate</span>(<span class="dt">datetime_num =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(datetime)) <span class="op">%&gt;%</span><span class="st">           </span>
<span class="st">  </span><span class="kw">step_ns</span>(datetime_num, <span class="dt">deg_free =</span> ns_df, <span class="dt">role =</span> <span class="st">'splines'</span>) <span class="op">%&gt;%</span><span class="st">                        </span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                 </span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()                                                    </code></pre></div>
<pre><code>#&gt;    n_obs n_coef    df        sigma r_squared adj_r_squared       AIC
#&gt; 1: 36362     49 36313 0.0003061451 0.9999527     0.9999527 -485200.9
#&gt;          BIC   logLik
#&gt; 1: -484775.8 242650.4</code></pre>
<p><img src="responsefunctions_files/figure-html/solvedistplot-1.png" width="412.8"><img src="responsefunctions_files/figure-html/solvedistplot-2.png" width="412.8"></p>
<hr>
</div>
</div>
<div id="earth-tides" class="section level1">
<h1 class="hasAnchor">
<a href="#earth-tides" class="anchor"></a>Earth tides</h1>
<p>In the previous two examples we used a lagged version of the pre-computed Earth tide signal. We also have the option of directly specifing the Earth tide calcuation in the recipe.</p>
<p>Three primary ways to do this as implemented in <em>waterlevel</em> are:</p>
<ol style="list-style-type: decimal">
<li><p>Using a lagged form of the Earth tide signal. This method uses the <em>earthtide</em> package to calculate a synthetic tide and lag the result. For datasets of less than 14 days, this is the preferred method. The problem is that the regression coefficients are not easily interpreted, but for removing a signal they work well.</p></li>
<li><p>Calculate the Earth tide components for wave groups and use those in the regression equation. This method uses the <em>earthtide</em> package to calculate synthetic tidal constituents.</p></li>
<li><p>Generate cosine curves of different frequencies. For this method the frequencies are specified in cycles per day and the appropriate sin and cos curves used in regression are created.</p></li>
</ol>
<p>Here are example steps for the above three methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Method 1</span>
<span class="kw"><a href="../reference/step_lag_earthtide.html">step_lag_earthtide</a></span>(datetime,
                   <span class="dt">lag =</span> et_lags,
                   <span class="dt">longitude =</span> <span class="op">-</span><span class="fl">118.67</span>,
                   <span class="dt">latitude =</span> <span class="fl">34.23</span>,
                   <span class="dt">elevation =</span> <span class="dv">550</span>,
                   <span class="dt">wave_groups =</span> wave_groups, 
                   <span class="dt">astro_update =</span> <span class="dv">60</span>)

<span class="co"># Method 2</span>
<span class="kw"><a href="../reference/step_earthtide.html">step_earthtide</a></span>(datetime,
               <span class="dt">longitude =</span> <span class="op">-</span><span class="fl">118.67</span>,
               <span class="dt">latitude =</span> <span class="fl">34.23</span>,
               <span class="dt">elevation =</span> <span class="dv">550</span>,
               <span class="dt">wave_groups =</span> wave_groups, 
               <span class="dt">astro_update =</span> <span class="dv">60</span>)

<span class="co"># Method 3 with top 6 diurnal and semi-diurnal signals O1, K1, P1, N2, M2, S2</span>
<span class="kw"><a href="../reference/step_harmonic.html">step_harmonic</a></span>(datetime,
              <span class="dt">freq =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.9295357</span>, <span class="fl">0.9972621</span>, <span class="fl">1.0027379</span>, 
                       <span class="fl">1.8959820</span>, <span class="fl">1.9322736</span>, <span class="fl">2.0000000</span>)) </code></pre></div>
<p>Let’s use our previous recipe for the distributed lag dataset but instead use method 2 for Earth tides.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Select wavegroups</span>
wave_groups &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(earthtide<span class="op">::</span>eterna_wavegroups)
wave_groups &lt;-<span class="st"> </span>wave_groups[start <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>]
wave_groups &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(wave_groups[time <span class="op">==</span><span class="st"> '1 month'</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'start'</span>, <span class="st">'end'</span>)])

knots &lt;-<span class="st"> </span><span class="kw"><a href="../reference/log_lags.html">log_lags</a></span>(<span class="dv">15</span>, max_lag_baro)
dat &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., transducer) <span class="op">%&gt;%</span><span class="st">                          </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_distributed_lag.html">step_distributed_lag</a></span>(baro, <span class="dt">knots =</span> knots) <span class="op">%&gt;%</span><span class="st">   </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_earthtide.html">step_earthtide</a></span>(datetime,
               <span class="dt">longitude =</span> <span class="op">-</span><span class="fl">118.67</span>,
               <span class="dt">latitude =</span> <span class="fl">34.23</span>,
               <span class="dt">elevation =</span> <span class="dv">550</span>,
               <span class="dt">wave_groups =</span> wave_groups, 
               <span class="dt">astro_update =</span> <span class="dv">60</span>) <span class="op">%&gt;%</span><span class="st">      </span>
<span class="st">  </span><span class="kw">step_mutate</span>(<span class="dt">datetime_num =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(datetime)) <span class="op">%&gt;%</span><span class="st">           </span>
<span class="st">  </span><span class="kw">step_ns</span>(datetime_num, <span class="dt">deg_free =</span> ns_df, <span class="dt">role =</span> <span class="st">'splines'</span>) <span class="op">%&gt;%</span><span class="st">                        </span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                 </span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()                                                    </code></pre></div>
<pre><code>#&gt;    n_obs n_coef    df        sigma r_squared adj_r_squared     AIC
#&gt; 1: 36362     60 36302 0.0003014908 0.9999542     0.9999541 -486304
#&gt;          BIC logLik
#&gt; 1: -485785.4 243213</code></pre>
<p><img src="responsefunctions_files/figure-html/solveharm2-1.png" width="412.8"><img src="responsefunctions_files/figure-html/solveharm2-2.png" width="412.8"></p>
<p><img src="responsefunctions_files/figure-html/solveharmet-1.png" width="412.8"><img src="responsefunctions_files/figure-html/solveharmet-2.png" width="412.8"></p>
<p>The three models tend to perform similarly for this well. However, I would choose the last model as it has the fewest, regressors, the lowest residual standard error, and provides useful Earth tide amplitude and phase information. This well had a generally small Earth tide component and it is hardly visible in the original wl pressure time series, however, we seem to be able achieve reasonable approximation of the theoretical amplitudes.</p>
</div>
<div id="frequency-domain-response-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#frequency-domain-response-functions" class="anchor"></a>Frequency domain response functions</h1>
<p>The following papers provide a good introduction to frequency response functions and their applications to water levels <span class="citation">(Rojstaczer and Agnew 1989,<span class="citation">Lai, Ge, and Wang (2013)</span>, <span class="citation">Hussein, Odling, and Clark (2013)</span>)</span>.</p>
<p>There are currently two ways to calculate the transfer function in the <em>waterlevel</em> package. Using the default method which smooths the periodogram, or using Welch’s method. See <em>spec_pgram</em> and <em>spec_welch</em> for parameters. Often there is a lot of noise at high frequencies. We plot Acworth’s method of static BE as a point in each figure, which is fundamentally just the value of the transfer function at 2 cycles per day (<span class="citation">Acworth et al. (2016)</span>). These methods also output the phase and coherence, but for the following plots we will stick to gain which can be thought of as the loading efficiency as a function of frequency for these examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
tf_pgram &lt;-<span class="st"> </span><span class="kw"><a href="../reference/transfer_fun.html">transfer_fun</a></span>(transducer,
                   <span class="dt">vars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'wl'</span>, <span class="st">'baro'</span>, <span class="st">'et'</span>), 
                   <span class="dt">time =</span> <span class="st">'datetime'</span>, 
                   <span class="dt">method =</span> <span class="st">'spec_pgram'</span>,
                   <span class="dt">spans =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>))



tf_welch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/transfer_fun.html">transfer_fun</a></span>(transducer,
                   <span class="dt">vars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'wl'</span>, <span class="st">'baro'</span>, <span class="st">'et'</span>), 
                   <span class="dt">time =</span> <span class="st">'datetime'</span>, 
                   <span class="dt">method =</span> <span class="st">'spec_welch'</span>,
                   <span class="dt">n_subsets =</span> <span class="dv">10</span>)

<span class="co"># Acworth BE</span>
be_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/be_acworth.html">be_acworth</a></span>(transducer, <span class="dt">wl =</span> <span class="st">'wl'</span>, <span class="dt">ba =</span> <span class="st">'baro'</span>, <span class="dt">et =</span> <span class="st">'et'</span>, 
                   <span class="dt">inverse =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="responsefunctions_files/figure-html/frfplot-1.png" width="700"><img src="responsefunctions_files/figure-html/frfplot-2.png" width="700"></p>
<p>One way to decrease the noise is to use Konno-Ohmachi smoothing <span class="citation">(Konno and Ohmachi 1998)</span>. This method can be slow for large datasets so we provide serial and parallel versions, <em>konno_ohmachi_parallel</em>, <em>konno_ohmachi_serial</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
tf_pgram &lt;-<span class="st"> </span>
<span class="st">  </span>tf_pgram <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gain_wl_baro_smooth =</span> <span class="kw"><a href="../reference/konno_ohmachi_parallel.html">konno_ohmachi_parallel</a></span>(tf_pgram<span class="op">$</span>gain_wl_baro, 
                                                      tf_pgram<span class="op">$</span>frequency, 
                                                      <span class="dt">b =</span> <span class="dv">10</span>))

tf_welch &lt;-<span class="st"> </span>
<span class="st">  </span>tf_welch <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gain_wl_baro_smooth =</span> <span class="kw"><a href="../reference/konno_ohmachi_parallel.html">konno_ohmachi_parallel</a></span>(tf_welch<span class="op">$</span>gain_wl_baro, 
                                                      tf_welch<span class="op">$</span>frequency, 
                                                      <span class="dt">b =</span> <span class="dv">10</span>))</code></pre></div>
<p><img src="responsefunctions_files/figure-html/frfsmoothplot-1.png" width="700"><img src="responsefunctions_files/figure-html/frfsmoothplot-2.png" width="700"></p>
<p>The frequency response methods are robust but often parameters may need to be tuned for a particular study. In particular, when calculating high frequency portions of spectra the Welch’s method with many subsets can perform well.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Acworth2016">
<p>Acworth, R. I., L. J. Halloran, G. C. Rau, M. O. Cuthbert, and T. L. Bernardi. 2016. “An objective frequency domain method for quantifying confined aquifer compressible storage using Earth and atmospheric tides.” <em>Geophysical Research Letters</em> 43 (22). John Wiley &amp; Sons, Ltd: 11, 671–11, 678. doi:<a href="https://doi.org/10.1002/2016GL071328">10.1002/2016GL071328</a>.</p>
</div>
<div id="ref-hussein2013borehole">
<p>Hussein, Mahmoud EA, Noelle E Odling, and Roger A Clark. 2013. “Borehole Water Level Response to Barometric Pressure as an Indicator of Aquifer Vulnerability.” <em>Water Resources Research</em> 49 (10). Wiley Online Library: 7102–19.</p>
</div>
<div id="ref-konno1998ground">
<p>Konno, Katsuaki, and Tatsuo Ohmachi. 1998. “Ground-Motion Characteristics Estimated from Spectral Ratio Between Horizontal and Vertical Components of Microtremor.” <em>Bulletin of the Seismological Society of America</em> 88 (1). The Seismological Society of America: 228–41.</p>
</div>
<div id="ref-lai2013transfer">
<p>Lai, Guijuan, Hongkui Ge, and Weilai Wang. 2013. “Transfer Functions of the Well-Aquifer Systems Response to Atmospheric Loading and Earth Tide from Low to High-Frequency Band.” <em>Journal of Geophysical Research: Solid Earth</em> 118 (5). Wiley Online Library: 1904–24.</p>
</div>
<div id="ref-rasmussen1997identifying">
<p>Rasmussen, Todd C, and Leslie A Crawford. 1997. “Identifying and Removing Barometric Pressure Effects in Confined and Unconfined Aquifers.” <em>Groundwater</em> 35 (3). Wiley Online Library: 502–11.</p>
</div>
<div id="ref-rasmussen2007monitoring">
<p>Rasmussen, Todd C, and Thomas L Mote. 2007. “Monitoring Surface and Subsurface Water Storage Using Confined Aquifer Water Levels at the Savannah River Site, Usa.” <em>Vadose Zone Journal</em> 6 (2). Soil Science Society: 327–35.</p>
</div>
<div id="ref-rojstaczer1989influence">
<p>Rojstaczer, Stuart, and Duncan Carr Agnew. 1989. “The Influence of Formation Material Properties on the Response of Water Levels in Wells to Earth Tides and Atmospheric Loading.” <em>Journal of Geophysical Research: Solid Earth</em> 94 (B9). Wiley Online Library: 12403–11.</p>
</div>
<div id="ref-toll2007removal">
<p>Toll, Nathanial J, and Todd C Rasmussen. 2007. “Removal of Barometric Pressure Effects and Earth Tides from Observed Water Levels.” <em>Groundwater</em> 45 (1). Wiley Online Library: 101–5.</p>
</div>
<div id="ref-wenzel1996nanogal">
<p>Wenzel, Hans-Georg. 1996. “The Nanogal Software: Earth Tide Data Processing Package Eterna 3.30.” <em>Bull. Inf. Marées Terrestres</em> 124: 9425–39.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#time-domain-barometric-response-function">Time domain barometric response function</a></li>
      <li><a href="#distributed-lag-method">Distributed lag method</a></li>
      </ul>
</li>
      <li><a href="#earth-tides">Earth tides</a></li>
      <li><a href="#frequency-domain-response-functions">Frequency domain response functions</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Kennel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
