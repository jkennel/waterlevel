<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synthetic example â€¢ waterlevel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Synthetic example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">waterlevel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/responsefunctions.html">Response functions</a>
    </li>
    <li>
      <a href="../articles/staticbe.html">Static Barometric/Loading Efficiency Calculations</a>
    </li>
    <li>
      <a href="../articles/synthetic_example.html">Synthetic example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Synthetic example</h1>
            
            <h4 class="date">2019-05-13</h4>
      
      
      <div class="hidden name"><code>synthetic_example.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>To test the efficiency of different methods we will create a response function, apply it to some barometric pressure data to generate a synthetic water level response.</p>
<div id="response-function" class="section level2">
<h2 class="hasAnchor">
<a href="#response-function" class="anchor"></a>Response function</h2>
<p>This is the function we will try to recreate! It is the combination of three exponentials of different lengths:</p>
<ul>
<li><p>60 second (negative)</p></li>
<li><p>600 second (negative)</p></li>
<li><p>43201 second (positive)</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp1 &lt;-<span class="st"> </span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.01</span>, <span class="dv">8</span>, <span class="dt">length.out =</span> <span class="dv">60</span>))
exp2 &lt;-<span class="st"> </span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.01</span>, <span class="dv">8</span>, <span class="dt">length.out =</span> <span class="dv">43201</span>))
exp3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.01</span>, <span class="dv">8</span>, <span class="dt">length.out =</span> <span class="dv">600</span>))

exp1 &lt;-<span class="st"> </span>exp1 <span class="op">/</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(exp1)
exp2 &lt;-<span class="st"> </span>exp2 <span class="op">/</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(exp2)
exp3 &lt;-<span class="st"> </span>exp3 <span class="op">/</span><span class="st"> </span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(exp3)

exp1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(exp1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="fl">0.0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(exp2) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(exp1)))
exp3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(exp3, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="fl">0.0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(exp2) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(exp3)))
kern &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(exp1 <span class="op">+</span><span class="st"> </span>exp2 <span class="op">+</span><span class="st"> </span>exp3)

resp_fun &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cumsum">cumsum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(kern))<span class="op">*</span><span class="fl">0.5</span></code></pre></div>
<pre><code>#&gt; Warning in xy.coords(x, y, xlabel, ylabel, log): 1 x value &lt;= 0 omitted
#&gt; from logarithmic plot</code></pre>
<p><img src="synthetic_example_files/figure-html/responseplot-1.png" width="384"></p>
</div>
<div id="barometric-pressure" class="section level2">
<h2 class="hasAnchor">
<a href="#barometric-pressure" class="anchor"></a>Barometric pressure</h2>
<p>We can get a barometric response with the <em>synthetic</em> function.</p>
</div>
<div id="synthetic-water-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#synthetic-water-levels" class="anchor"></a>Synthetic water levels</h2>
<p>Convolution of barometric pressure data and response function. Water levels have a dampened appearance and are lagged slightly in relation to the barometric response. This is commonly observed at field sites. There is no noise in this example so we hope to perfectly recover the response function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/synthetic.html">synthetic</a></span>(<span class="dt">sd_noise =</span> <span class="fl">0e-2</span>,
                 <span class="dt">sd_noise_trend =</span> <span class="fl">0e-12</span>,
                 <span class="dt">n =</span> <span class="dv">4</span><span class="op">*</span><span class="dv">86400</span>,
                 <span class="dt">linear_trend =</span> <span class="fl">0e-12</span>,
                 <span class="dt">seed =</span> <span class="dv">1</span>,
                 <span class="dt">baro_kernel =</span> kern)[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(datetime, baro, wl)]

dat &lt;-<span class="st"> </span>dat[<span class="dv">1</span><span class="op">:</span>(<span class="fl">2.5</span><span class="op">*</span><span class="dv">86400</span>)]
dat[, baro <span class="op">:</span><span class="er">=</span><span class="st"> </span>baro <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(baro, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)]
dat[, wl <span class="op">:</span><span class="er">=</span><span class="st"> </span>wl <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(wl, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)]</code></pre></div>
<p><img src="synthetic_example_files/figure-html/syntheticplot-1.png" width="576"></p>
</div>
<div id="regular-lag-method" class="section level2">
<h2 class="hasAnchor">
<a href="#regular-lag-method" class="anchor"></a>Regular lag method</h2>
<p>Regular lag methods can generate large regression matrices, and therefore, we will subset our data prior to analysis. We start with one second data, but will subset to 60 seconds. The matrix size will be</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="dv">60</span>

dat_sub &lt;-<span class="st"> </span>dat[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dat), dt)]

ba_lags &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, (<span class="dv">43200</span><span class="op">+</span>dt)<span class="op">/</span>dt, <span class="dv">1</span>)

rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., dat_sub) <span class="op">%&gt;%</span><span class="st">                          </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_lag_matrix.html">step_lag_matrix</a></span>(baro, <span class="dt">lag =</span> ba_lags) <span class="op">%&gt;%</span><span class="st">                   </span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                </span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(rec)
<span class="co">#&gt; [1] 3600    3</span></code></pre></div>
<div id="do-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#do-regression" class="anchor"></a>Do regression</h3>
<p>What if we only had data every 30 minutes?</p>
<pre><code>#&gt;    n_obs n_coef   df        sigma r_squared adj_r_squared       AIC
#&gt; 1:  2879    723 2156 5.316373e-05  0.999997      0.999996 -47885.33
#&gt;          BIC   logLik
#&gt; 1: -43566.53 24666.67</code></pre>
<p><img src="synthetic_example_files/figure-html/regular_regress-1.png" width="576"></p>
</div>
</div>
<div id="irregular-lag-method" class="section level2">
<h2 class="hasAnchor">
<a href="#irregular-lag-method" class="anchor"></a>Irregular lag method</h2>
<p>We wonâ€™t subset in this case. We will use fewer regressors but have many more observations. These results are even better.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ba_lags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/log_lags.html">log_lags</a></span>(<span class="dv">251</span>, <span class="dt">max_time_lag =</span> <span class="dv">43201</span>)

rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., dat) <span class="op">%&gt;%</span><span class="st">                          </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_lag_matrix.html">step_lag_matrix</a></span>(baro, <span class="dt">lag =</span> ba_lags) <span class="op">%&gt;%</span><span class="st">                   </span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                </span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(rec)
<span class="co">#&gt; [1] 216000      3</span></code></pre></div>
<pre><code>#&gt;     n_obs n_coef     df        sigma r_squared adj_r_squared      AIC
#&gt; 1: 172800    201 172599 2.341373e-05 0.9999992     0.9999992 -3194264
#&gt;         BIC  logLik
#&gt; 1: -3192232 1597334</code></pre>
<p><img src="synthetic_example_files/figure-html/irregular_regress-1.png" width="576"></p>
</div>
<div id="distributed-lag-method" class="section level2">
<h2 class="hasAnchor">
<a href="#distributed-lag-method" class="anchor"></a>Distributed lag method</h2>
<p>We wonâ€™t subset in this case and we will only use 15 regressors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ba_lags &lt;-<span class="st"> </span><span class="kw"><a href="../reference/log_lags.html">log_lags</a></span>(<span class="dv">18</span>, <span class="dt">max_time_lag =</span> <span class="dv">43201</span>)

rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(wl<span class="op">~</span>., dat) <span class="op">%&gt;%</span><span class="st">                          </span>
<span class="st">  </span><span class="kw"><a href="../reference/step_distributed_lag.html">step_distributed_lag</a></span>(baro, <span class="dt">knots =</span> ba_lags) <span class="op">%&gt;%</span><span class="st">                   </span>
<span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span><span class="st">                                                </span>
<span class="st">  </span><span class="kw"><a href="../reference/portion.html">portion</a></span>()

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(rec)
<span class="co">#&gt; [1] 216000      3</span></code></pre></div>
<pre><code>#&gt;     n_obs n_coef     df        sigma r_squared adj_r_squared      AIC
#&gt; 1: 172800     19 172781 5.672424e-06         1             1 -3684405
#&gt;         BIC  logLik
#&gt; 1: -3684204 1842223</code></pre>
<p><img src="synthetic_example_files/figure-html/dist_regress-1.png" width="576"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#response-function">Response function</a></li>
      <li><a href="#barometric-pressure">Barometric pressure</a></li>
      <li><a href="#synthetic-water-levels">Synthetic water levels</a></li>
      <li><a href="#regular-lag-method">Regular lag method</a></li>
      <li><a href="#irregular-lag-method">Irregular lag method</a></li>
      <li><a href="#distributed-lag-method">Distributed lag method</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Kennel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
